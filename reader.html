<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Sentence Reader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #inputText {
            width: 100%;
            height: 100px;
        }
        #output {
            margin-top: 20px;
        }
        .sentence {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .speaker {
            cursor: pointer;
            margin-right: 10px;
            font-size: 20px;
        }
        .sentence-text {
            flex: 1;
        }
        .word {
            cursor: pointer;
            padding: 2px;
        }
        .highlight {
            background-color: yellow;
        }
    </style>
</head>
<body>
    <h1>English Sentence Reader</h1>
    <textarea id="inputText" placeholder="Enter English text here..."></textarea>
    <button id="processBtn">Process Text</button>
    <div id="output"></div>

    <script>
        const processBtn = document.getElementById('processBtn');
        const inputText = document.getElementById('inputText');
        const output = document.getElementById('output');

        processBtn.addEventListener('click', processInput);

        // Function to get the Ava high-quality voice on iPhone
        function getAvaVoice() {
            return new Promise((resolve) => {
                let voices = speechSynthesis.getVoices();
                const checkVoices = () => {
                    voices = speechSynthesis.getVoices();
                    // Look for voices with 'Ava' in the name, preferring enhanced/high-quality
                    const avaVoice = voices.find(voice => 
                        voice.name.toLowerCase().includes('ava') && 
                        voice.lang === 'en-US' && 
                        (voice.name.toLowerCase().includes('enhanced') || voice.name.toLowerCase().includes('premium') || voice.quality === 'enhanced' || voice.default)
                    ) || voices.find(voice => voice.name.toLowerCase().includes('ava') && voice.lang === 'en-US') || 
                      voices.find(voice => voice.lang === 'en-US' && voice.default);

                    resolve(avaVoice);
                };

                if (voices.length > 0) {
                    checkVoices();
                } else {
                    speechSynthesis.onvoiceschanged = checkVoices;
                }
            });
        }

        function processInput() {
            const text = inputText.value.trim();
            if (!text) return;

            // Split into sentences based on punctuation: . ! ? , ; :
            const sentences = text.match(/[^.!?,;:]+[.!?,;:]*/g) || [];
            
            output.innerHTML = ''; // Clear previous output

            sentences.forEach((sentence, index) => {
                const sentenceDiv = document.createElement('div');
                sentenceDiv.classList.add('sentence');

                // Speaker icon
                const speaker = document.createElement('span');
                speaker.classList.add('speaker');
                speaker.textContent = 'ðŸ”Š';
                speaker.addEventListener('click', () => readSentence(sentence, sentenceText));

                // Sentence text container
                const sentenceText = document.createElement('span');
                sentenceText.classList.add('sentence-text');

                // Split sentence into words (including punctuation attached to words)
                const words = sentence.trim().split(/\s+/);
                words.forEach(word => {
                    const wordSpan = document.createElement('span');
                    wordSpan.classList.add('word');
                    wordSpan.textContent = word + ' '; // Add space back
                    wordSpan.addEventListener('click', () => readWord(word, wordSpan));
                    sentenceText.appendChild(wordSpan);
                });

                sentenceDiv.appendChild(speaker);
                sentenceDiv.appendChild(sentenceText);
                output.appendChild(sentenceDiv);
            });
        }

        async function readSentence(sentence, sentenceText) {
            // Remove previous highlights
            document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));

            // Highlight the sentence
            sentenceText.classList.add('highlight');

            // Speak the sentence using Ava voice
            const voice = await getAvaVoice();
            const utterance = new SpeechSynthesisUtterance(sentence.trim());
            utterance.lang = 'en-US';
            if (voice) utterance.voice = voice;
            utterance.onend = () => {
                sentenceText.classList.remove('highlight');
            };
            speechSynthesis.speak(utterance);
        }

        async function readWord(word, wordSpan) {
            // Remove previous highlights
            document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));

            // Highlight the word
            wordSpan.classList.add('highlight');

            // Clean word by removing punctuation for pronunciation
            const cleanWord = word.replace(/[.,!?;:]/g, '');

            // Speak the word using Ava voice
            const voice = await getAvaVoice();
            const utterance = new SpeechSynthesisUtterance(cleanWord);
            utterance.lang = 'en-US';
            if (voice) utterance.voice = voice;
            utterance.onend = () => {
                wordSpan.classList.remove('highlight');
            };
            speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
