<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Reader</title>

<!-- Ë∞∑Ê≠åÂÆòÊñπÊ†áÂáÜÂõæÊ†á -->
<link rel="apple-touch-icon" href="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png">
<link rel="icon" href="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}
body {
  background: #f7f8fa;
  padding: 20px;
  max-width: 800px;
  margin: 0 auto;
}
.title {
  text-align: center;
  font-size: 32px;
  font-weight: bold;
  color: #2c3e50;
  margin: 30px 0 20px;
}
#voiceSelect {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border: 1px solid #ddd;
  border-radius: 12px;
  margin-bottom: 10px;
  background: #fff;
  outline: none;
}
#inputArea {
  width: 100%;
  height: 180px;
  padding: 15px;
  font-size: 16px;
  border: 1px solid #ddd;
  border-radius: 12px;
  resize: vertical;
  outline: none;
  background: white;
}
#goBtn {
  width: 100%;
  padding: 14px;
  font-size: 18px;
  font-weight: 600;
  background: #007aff;
  color: white;
  border: none;
  border-radius: 12px;
  margin: 12px 0 25px;
  cursor: pointer;
}
#result {
  line-height: 1.8;
  font-size: 18px;
}
.sentence {
  display: flex;
  align-items: center;
  padding: 14px 12px;
  border-radius: 10px;
  margin-bottom: 10px;
  background: #fff;
  border: 1px solid #eee;
  transition: background 0.2s;
  cursor: pointer;
}
.sentence.active {
  background: #e1f5fe;
  border-color: #007aff;
}
.speaker {
  margin-right: 12px;
  font-size: 24px;
  user-select: none;
  flex-shrink: 0;
}
.word {
  display: inline-block;
  padding: 2px 4px;
  border-radius: 4px;
  cursor: pointer;
}
.word.active {
  background: #ffeb3b;
  font-weight: 500;
}
</style>
</head>
<body>
  <div class="title">English Reader</div>
  <select id="voiceSelect"></select>
  <textarea id="inputArea" placeholder="Paste your English text here..."></textarea>
  <button id="goBtn">Go</button>
  <div id="result"></div>

<script>
const inputArea = document.getElementById('inputArea');
const goBtn = document.getElementById('goBtn');
const result = document.getElementById('result');
const voiceSelect = document.getElementById('voiceSelect');

let allVoices = [];
let currentUtterance = null;

function loadVoices() {
  allVoices = window.speechSynthesis.getVoices();
  voiceSelect.innerHTML = '';
  allVoices.forEach((voice, i) => {
    if (voice.lang.includes('en')) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = `${voice.name} (${voice.lang})`;
      voiceSelect.appendChild(option);
    }
  });
  const samanthaIndex = allVoices.findIndex(v => 
    v.name.includes('Samantha') && v.lang.includes('en-US')
  );
  if (samanthaIndex !== -1) voiceSelect.value = samanthaIndex;
}

function getSelectedVoice() {
  return allVoices[voiceSelect.value] || allVoices.find(v => v.lang.includes('en-US'));
}

window.speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

goBtn.addEventListener('click', () => {
  const text = inputArea.value.trim();
  if (!text) return;
  const splitSymbols = /([.,?!;:„ÄÅÔºå„ÄÇÔºüÔºÅÔºõÔºö])/g;
  const rawParts = text.split(splitSymbols);
  const segments = [];
  for (let i = 0; i < rawParts.length; i += 2) {
    let part = (rawParts[i] || '') + (rawParts[i + 1] || '');
    part = part.trim();
    if (part) segments.push(part);
  }
  renderResult(segments);
});

function renderResult(segments) {
  result.innerHTML = '';
  segments.forEach(seg => {
    const sentenceDiv = document.createElement('div');
    sentenceDiv.className = 'sentence';
    const speaker = document.createElement('div');
    speaker.className = 'speaker';
    speaker.textContent = 'üîä';
    const wordsDiv = document.createElement('div');
    wordsDiv.style.width = '100%';
    seg.split(/\s+/).filter(Boolean).forEach(word => {
      const w = document.createElement('span');
      w.className = 'word';
      w.textContent = word;
      w.onclick = (e) => { e.stopPropagation(); speakWord(word, w); };
      wordsDiv.appendChild(w);
      wordsDiv.appendChild(document.createTextNode(' '));
    });
    sentenceDiv.appendChild(speaker);
    sentenceDiv.appendChild(wordsDiv);
    sentenceDiv.onclick = () => speakSentence(seg, sentenceDiv);
    result.appendChild(sentenceDiv);
  });
}

function speakSentence(text, sentenceEl) {
  stopSpeaking();
  document.querySelectorAll('.sentence').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.word').forEach(w => w.classList.remove('active'));
  const u = new SpeechSynthesisUtterance(text);
  u.voice = getSelectedVoice();
  u.rate = 0.96;
  u.pitch = 1.0;
  sentenceEl.classList.add('active');
  u.onend = () => sentenceEl.classList.remove('active');
  window.speechSynthesis.speak(u);
  currentUtterance = u;
}

function speakWord(word, wordEl) {
  stopSpeaking();
  document.querySelectorAll('.sentence').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.word').forEach(w => w.classList.remove('active'));
  wordEl.classList.add('active');
  const u = new SpeechSynthesisUtterance(word);
  u.voice = getSelectedVoice();
  u.rate = 0.9;
  window.speechSynthesis.speak(u);
}

function stopSpeaking() {
  if (window.speechSynthesis.speaking) {
    window.speechSynthesis.cancel();
  }
}
</script>
</body>
</html>
