<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Reader</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

body {
  background: #f7f8fa;
  padding: 20px;
  max-width: 800px;
  margin: 0 auto;
}

.title {
  text-align: center;
  font-size: 32px;
  font-weight: bold;
  color: #2c3e50;
  margin: 30px 0 20px;
  cursor: pointer;
}

#voiceSelect {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border: 1px solid #ddd;
  border-radius: 12px;
  margin-bottom: 10px;
  background: #fff;
  outline: none;
}

#inputArea {
  width: 100%;
  height: 180px;
  padding: 15px;
  font-size: 16px;
  border: 1px solid #ddd;
  border-radius: 12px;
  resize: vertical;
  outline: none;
  background: white;
}

#goBtn {
  width: 100%;
  padding: 14px;
  font-size: 18px;
  font-weight: 600;
  background: #007aff;
  color: white;
  border: none;
  border-radius: 12px;
  margin: 12px 0 25px;
  cursor: pointer;
}

#result {
  line-height: 1.8;
  font-size: 18px;
}

.sentence {
  display: flex;
  align-items: center;
  padding: 14px 12px;
  border-radius: 10px;
  margin-bottom: 10px;
  background: #fff;
  border: 1px solid #eee;
  transition: background 0.2s;
  cursor: pointer;
}

.sentence.active {
  background: #e1f5fe;
  border-color: #007aff;
}

.speaker {
  margin-right: 12px;
  font-size: 24px;
  user-select: none;
  flex-shrink: 0;
}

.word {
  display: inline-block;
  padding: 2px 4px;
  border-radius: 4px;
  cursor: pointer;
}

.word.active {
  background: #ffeb3b;
  font-weight: 500;
}
</style>
</head>

<body>
  <div class="title">English Reader</div>

  <select id="voiceSelect"></select>

  <textarea id="inputArea" placeholder="Paste your English text here..."></textarea>
  <button id="goBtn">Go</button>
  <div id="result"></div>

<script>
const inputArea = document.getElementById('inputArea');
const goBtn = document.getElementById('goBtn');
const result = document.getElementById('result');
const voiceSelect = document.getElementById('voiceSelect');
const titleEl = document.querySelector('.title');

let allVoices = [];
let currentUtterance = null;

function loadVoices() {
  allVoices = window.speechSynthesis.getVoices();
  voiceSelect.innerHTML = '';
  allVoices.forEach((voice, i) => {
    if (voice.lang.includes('en')) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = `${voice.name} (${voice.lang})`;
      voiceSelect.appendChild(option);
    }
  });
  const samanthaIndex = allVoices.findIndex(v =>
    v.name.includes('Samantha') && v.lang.includes('en-US')
  );
  if (samanthaIndex !== -1) {
    voiceSelect.value = samanthaIndex;
  }
}

function getSelectedVoice() {
  return allVoices[voiceSelect.value] || allVoices.find(v => v.lang.includes('en-US'));
}

window.speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
// Êñ∞ÁâàÊô∫ËÉΩÊñ≠Âè•ÔºöÂè™Âú®ÁúüÊ≠£Âè•Êú´ÊãÜÂàÜ
// ‰øùÊä§ÔºöÊó∂Èó¥ 3:30„ÄÅU.S.A.„ÄÅa.m.„ÄÅJan.1st Á≠â
// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
goBtn.addEventListener('click', () => {
  const text = inputArea.value.trim();
  if (!text) return;

  const sentences = splitIntoRealSentences(text);
  renderResult(sentences);
});

function splitIntoRealSentences(text) {
  const s = text.replace(/\s+/g, ' ').trim();

  // 1. ‰øùÊä§ Êó∂Èó¥ 12:30 3:30 ËøôÁ±ªÂÜíÂè∑
  let t = s.replace(/(\d):(\d)/g, '$1‚è±$2');

  // 2. ‰øùÊä§ÂÜÖÈÉ®ÁÇπÔºöU.S.A. a.m. p.m. Mr. Dr. Jan. Feb. Á≠â
  const protectPatterns = [
    /\b([A-Z])\.([A-Z])\.([A-Z])\./gi,
    /\b([A-Z])\.([A-Z])\./gi,
    /\b[a-z]\.[a-z]\./gi,
    /\b(Mr|Mrs|Ms|Dr|Prof|Sr|Jr|St|Jan|Feb|Mar|Apr|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\./gi
  ];
  protectPatterns.forEach(re => {
    t = t.replace(re, m => m.replace(/\./g, '‚Ä¢'));
  });

  // 3. Âè™Âú® Âè•Êú´ . ! ? + Á©∫Ê†º/ÁªìÂ∞æ Â§ÑÊãÜÂàÜ
  const parts = t.split(/(?<=[.!?])\s+/);

  // 4. ËøòÂéüÁ¨¶Âè∑
  return parts.map(p =>
    p.replace(/‚è±/g, ':').replace(/‚Ä¢/g, '.').trim()
  ).filter(Boolean);
}

// ÁÇπÂáªÊ†áÈ¢òÊúóËØªÂÖ®Êñá
titleEl.addEventListener('click', () => {
  const fullText = inputArea.value.trim();
  if (!fullText) return;
  stopSpeaking();
  document.querySelectorAll('.sentence, .word').forEach(el => el.classList.remove('active'));
  const u = new SpeechSynthesisUtterance(fullText);
  u.voice = getSelectedVoice();
  u.rate = 0.96;
  u.pitch = 1.0;
  window.speechSynthesis.speak(u);
  currentUtterance = u;
});

// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ÂéüÊúâÊ∏≤Êüì‰∏éÊúóËØªÂÆåÂÖ®‰∏çÂèò ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
function renderResult(segments) {
  result.innerHTML = '';
  segments.forEach(seg => {
    const sentenceDiv = document.createElement('div');
    sentenceDiv.className = 'sentence';

    const speaker = document.createElement('div');
    speaker.className = 'speaker';
    speaker.textContent = 'üîä';

    const wordsDiv = document.createElement('div');
    wordsDiv.style.width = '100%';

    const words = seg.split(/\s+/).filter(Boolean);
    words.forEach(word => {
      const w = document.createElement('span');
      w.className = 'word';
      w.textContent = word;
      w.onclick = (e) => {
        e.stopPropagation();
        speakWord(word, w);
      };
      wordsDiv.appendChild(w);
      wordsDiv.appendChild(document.createTextNode(' '));
    });

    sentenceDiv.appendChild(speaker);
    sentenceDiv.appendChild(wordsDiv);
    sentenceDiv.onclick = () => speakSentence(seg, sentenceDiv);
    result.appendChild(sentenceDiv);
  });
}

function speakSentence(text, sentenceEl) {
  stopSpeaking();
  document.querySelectorAll('.sentence, .word').forEach(el => el.classList.remove('active'));
  const u = new SpeechSynthesisUtterance(text);
  u.voice = getSelectedVoice();
  u.rate = 0.96;
  u.pitch = 1.0;
  sentenceEl.classList.add('active');
  u.onend = () => sentenceEl.classList.remove('active');
  window.speechSynthesis.speak(u);
  currentUtterance = u;
}

function speakWord(word, wordEl) {
  stopSpeaking();
  document.querySelectorAll('.sentence, .word').forEach(el => el.classList.remove('active'));
  wordEl.classList.add('active');
  const u = new SpeechSynthesisUtterance(word);
  u.voice = getSelectedVoice();
  u.rate = 0.9;
  window.speechSynthesis.speak(u);
}

function stopSpeaking() {
  if (window.speechSynthesis.speaking) {
    window.speechSynthesis.cancel();
  }
}
</script>
</body>
</html>